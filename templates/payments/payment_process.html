{% extends 'base.html' %}

{% block content %}
    <div class="card shadow-custom col-lg-4 border-0 mx-auto">
        <h3 class="text-grey text-center">
            <strong>Order Details</strong>
        </h3>

        <div class="row justify-content-center">
            <form id="order-payment" method="post">
                {% csrf_token %}
                <label for="amount"></label>
                <input type="number" value="{{ total_cost }}" id="amount" name="amount" readonly>
{#                <button type="submit" class="btn btn-warning" onclick="payWithPaystack()">#}
                <button class="btn btn-warning" onclick="payWithPaystack()">
                    <span class="fas fa-credit-card"></span> <strong>Pay with Paystack</strong>
                </button>
            </form>
        </div>
    </div>

    <!-- scripts -->
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <script>
        const paymentForm = document.getElementById('order-payment');
        paymentForm.addEventListener('submit', payWithPaystack, false);
        function payWithPaystack(e) {
            e.preventDefault();

            let handler = PaystackPop.setup({
                key: "{{ paystack_public_key }}",
                email: order_details.email,
                amount: document.getElementById('amount').value * 100,
                currency: "NGN",
                onClose: function(){
                      alert('Window closed.');
                },
                callback: function(response){
                    let message = 'Payment complete! Reference: ' + response.reference;
                    alert(message);
                    window.location = {% url 'orders:order-created' %}
                }
            });

            handler.openIframe();
        }
    </script>
{% endblock %}